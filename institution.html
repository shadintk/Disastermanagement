<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DISASTER.prep â€” Institution Portal</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- NDMA Banner -->
  <div class="ndma-banner">
    <img src="ndmalogo.png" alt="NDMA Logo"/>
    <div class="ndma-content">
      <h1>National Disaster Management Authority</h1>
      <h2>Government of India</h2>
    </div>
  </div>

  <header class="site-header">
    <div class="container header-inner">
      <div class="brand"><a href="index.html">DISASTER.prep</a></div>
      <nav class="main-nav" id="main-nav">
        <a href="index.html">Home</a>
        <a href="institution.html" class="active">Institution Portal</a>
        <a href="students.html">Student Portal</a>
        <a href="admin.html">Admin Dashboard</a>
        <a href="reported.html">Reported</a>
      </nav>
      <div class="auth">
        <a href="reported.html" class="btn btn-outline" id="reported-btn">ðŸ“Š Reported Details</a>
        <a href="login.html" class="btn btn-login" id="login-btn">Login</a>
        <a href="registration.html" class="btn btn-register" id="register-btn">Register</a>
        <a href="#" class="btn btn-logout" id="logout-btn" style="display: none;">Logout</a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Institution Hero Section -->
    <section class="teacher-hero">
      <div class="teacher-hero-content">
        <div class="teacher-hero-text">
          <h1 class="teacher-title">
            <span class="title-line">Institution</span>
            <span class="title-line highlight">Portal</span>
          </h1>
          <p class="teacher-subtitle">Manage disaster preparedness training, schedule drills, and monitor student progress</p>
          <div class="teacher-stats">
            <div class="stat-badge">
              <span class="stat-number" id="total-drills">0</span>
              <span class="stat-text">Total Drills</span>
            </div>
            <div class="stat-badge">
              <span class="stat-number" id="students-trained">0</span>
              <span class="stat-text">Students Trained</span>
            </div>
            <div class="stat-badge">
              <span class="stat-number" id="completion-rate">--%</span>
              <span class="stat-text">Completion Rate</span>
            </div>
          </div>
        </div>
        <div class="teacher-hero-visual">
          <div class="floating-teacher-cards">
            <div class="floating-teacher-card" style="top: 20px; left: 20px; animation-delay: 0.2s;">
              <div class="card-icon">ðŸ“…</div>
              <div class="card-text">Schedule</div>
            </div>
            <div class="floating-teacher-card" style="top: 80px; right: 30px; animation-delay: 0.4s;">
              <div class="card-icon">ðŸ“Š</div>
              <div class="card-text">Analytics</div>
            </div>
            <div class="floating-teacher-card" style="bottom: 40px; left: 50px; animation-delay: 0.6s;">
              <div class="card-icon">ðŸŽ¯</div>
              <div class="card-text">Training</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Actions Section -->
    <section class="quick-actions-section">
      <div class="actions-container">
        <h2 class="actions-title">Quick Actions</h2>
        <div class="actions-grid">
          <div class="action-card" onclick="location.href='emergency.html'">
            <div class="action-icon">ðŸš¨</div>
            <div class="action-content">
              <h3>Emergency Alert</h3>
              <p>Trigger emergency protocols and notify all students</p>
            </div>
          </div>
          <div class="action-card" onclick="showTrainingModal()">
            <div class="action-icon">ðŸ“…</div>
            <div class="action-content">
              <h3>Schedule Training</h3>
              <p>Create and schedule training sessions for students</p>
            </div>
          </div>
          <div class="action-card" onclick="showAnalytics()">
            <div class="action-icon">ðŸ“Š</div>
            <div class="action-content">
              <h3>View Analytics</h3>
              <p>Monitor student progress and drill performance</p>
            </div>
          </div>
          <div class="action-card" onclick="showTemplates()">
            <div class="action-icon">ðŸ“‹</div>
            <div class="action-content">
              <h3>Drill Templates</h3>
              <p>Access pre-built drill templates and resources</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Training Management Section -->
    <section class="drill-management-section">
      <div class="drill-container">
        <div class="drill-header">
          <h2 class="drill-title">Training Management</h2>
          <button class="btn btn-primary" onclick="showTrainingModal()">+ Schedule Training</button>
        </div>

        <div class="drill-tabs">
          <button class="drill-tab active" onclick="showTrainingTab('scheduled')">Scheduled Training</button>
          <button class="drill-tab" onclick="showTrainingTab('resources')">Resources</button>
          <button class="drill-tab" onclick="showTrainingTab('history')">History</button>
        </div>

        <div id="scheduled-training" class="drill-content">
          <div class="drill-list" id="scheduled-list">
            <!-- Scheduled training will be populated here -->
          </div>
        </div>

        <div id="resources-training" class="drill-content" style="display: none;">
          <div class="templates-grid">
            <div class="template-card" onclick="location.href='students.html'">
              <div class="template-icon">ðŸŽ“</div>
              <div class="template-content">
                <h3>Student Training</h3>
                <p>Access student training modules and drills</p>
                <div class="template-meta">
                  <span class="template-duration">Self-paced</span>
                  <span class="template-level">All Levels</span>
                </div>
              </div>
            </div>
            <div class="template-card" onclick="location.href='reported.html'">
              <div class="template-icon">ðŸ“Š</div>
              <div class="template-content">
                <h3>Emergency Reports</h3>
                <p>View and manage emergency reports</p>
                <div class="template-meta">
                  <span class="template-duration">Real-time</span>
                  <span class="template-level">Monitoring</span>
                </div>
              </div>
            </div>
            <div class="template-card" onclick="location.href='emergency.html'">
              <div class="template-icon">ðŸš¨</div>
              <div class="template-content">
                <h3>Emergency System</h3>
                <p>Emergency reporting and response system</p>
                <div class="template-meta">
                  <span class="template-duration">24/7</span>
                  <span class="template-level">Critical</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="history-training" class="drill-content" style="display: none;">
          <div class="history-list" id="history-list">
            <!-- Training history will be populated here -->
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Training Creation Modal -->
  <div id="training-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Schedule Training Session</h3>
        <button class="modal-close" onclick="hideTrainingModal()">&times;</button>
      </div>
      <form id="training-form" class="modal-form">
        <div class="form-group">
          <label class="form-label">Training Title</label>
          <input id="training-title-input" class="form-input" required placeholder="Enter training title" />
        </div>
        <div class="form-group">
          <label class="form-label">Training Type</label>
          <select id="training-type-input" class="form-input" required>
            <option value="">Select training type</option>
            <option value="safety">Safety Training</option>
            <option value="emergency">Emergency Response</option>
            <option value="preparedness">Disaster Preparedness</option>
            <option value="evacuation">Evacuation Procedures</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Scheduled Date & Time</label>
          <input id="training-date-input" class="form-input" type="datetime-local" />
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea id="training-description-input" class="form-textarea" placeholder="Enter training description..." rows="3"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="hideTrainingModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Schedule Training</button>
        </div>
      </form>
    </div>
  </div>

  <footer class="site-footer">Â© <span id="year4"></span> DISASTER.prep â€” Institution Portal</footer>

  <script src="script.js"></script>
  <script>
    document.getElementById('year4').innerText = new Date().getFullYear();
    
    // Load scheduled drills from localStorage
    function renderScheduled() {
      const list = JSON.parse(localStorage.getItem('dp_scheduled') || '[]');
      const ul = document.getElementById('scheduled-list');
      ul.innerHTML = '';
      
      if (list.length === 0) {
        ul.innerHTML = '<div class="empty-state"><p>No scheduled drills</p><button class="btn btn-primary" onclick="showDrillModal()">Create Your First Drill</button></div>';
        return;
      }
      
      list.forEach(item => {
        const drillCard = document.createElement('div');
        drillCard.className = 'drill-card';
        drillCard.innerHTML = `
          <div class="drill-card-header">
            <h4>${escapeHtml(item.title)}</h4>
            <span class="drill-type-badge">${item.type}</span>
          </div>
          <div class="drill-card-content">
            <p>${item.description || 'No description provided'}</p>
            <div class="drill-card-meta">
              <span class="drill-date">${item.date ? new Date(item.date).toLocaleString() : 'No date set'}</span>
            </div>
          </div>
          <div class="drill-card-actions">
            <button class="btn btn-secondary" onclick="runDrill(${item.id})">Run Now</button>
            <button class="btn btn-outline" onclick="editDrill(${item.id})">Edit</button>
            <button class="btn btn-danger" onclick="deleteDrill(${item.id})">Delete</button>
          </div>
        `;
        ul.appendChild(drillCard);
      });
    }

    function runDrill(id) {
      const list = JSON.parse(localStorage.getItem('dp_scheduled') || '[]');
      const item = list.find(i => i.id === id);
      if (item) location.href = 'drill.html?template=' + encodeURIComponent(item.type);
    }

    function editDrill(id) {
      const list = JSON.parse(localStorage.getItem('dp_scheduled') || '[]');
      const item = list.find(i => i.id === id);
      if (item) {
        document.getElementById('drill-title-input').value = item.title;
        document.getElementById('drill-type-input').value = item.type;
        document.getElementById('drill-date-input').value = item.date || '';
        document.getElementById('drill-description-input').value = item.description || '';
        showDrillModal();
      }
    }

    function deleteDrill(id) {
      if (confirm('Are you sure you want to delete this drill?')) {
        const list = JSON.parse(localStorage.getItem('dp_scheduled') || '[]');
        const filtered = list.filter(i => i.id !== id);
        localStorage.setItem('dp_scheduled', JSON.stringify(filtered));
        renderScheduled();
      }
    }

    function showTrainingModal() {
      document.getElementById('training-modal').style.display = 'flex';
    }

    function hideTrainingModal() {
      document.getElementById('training-modal').style.display = 'none';
      document.getElementById('training-form').reset();
    }

    function showTrainingTab(tab) {
      // Hide all content
      document.querySelectorAll('.drill-content').forEach(content => content.style.display = 'none');
      document.querySelectorAll('.drill-tab').forEach(tab => tab.classList.remove('active'));
      
      // Show selected content
      document.getElementById(tab + '-training').style.display = 'block';
      event.target.classList.add('active');
    }

    function showAnalytics() {
      alert('Analytics feature coming soon!');
    }

    function showTemplates() {
      showTrainingTab('resources');
    }

    // Training form submission
    document.getElementById('training-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const title = document.getElementById('training-title-input').value.trim();
      const type = document.getElementById('training-type-input').value;
      const date = document.getElementById('training-date-input').value;
      const description = document.getElementById('training-description-input').value.trim();
      
      if (!title) { alert('Enter training title'); return; }
      
      const list = JSON.parse(localStorage.getItem('dp_scheduled') || '[]');
      const obj = { id: Date.now(), title, type, date, description };
      list.unshift(obj);
      localStorage.setItem('dp_scheduled', JSON.stringify(list));
      
      renderScheduled();
      hideTrainingModal();
      alert('Training scheduled successfully!');
    });

    // Initialize
    renderScheduled();
    
    // Initialize authentication
    initAuth();
    
    // Hide navigation when logged in as institution
    const user = JSON.parse(localStorage.getItem('dp_user') || 'null');
    if (user && (user.role === 'institution' || user.role === 'teacher')) {
      document.getElementById('main-nav').style.display = 'none';
    }
  </script>
</body>
</html>
